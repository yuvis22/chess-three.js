(()=>{"use strict";var e,t,r={504:(e,t,r)=>{var o=r(941);const a={p:100,n:280,b:320,r:479,q:929,k:9e3,k_endGame:9e3},s={p:[[100,100,100,100,105,100,100,100],[78,83,86,73,102,82,85,90],[7,29,21,44,40,31,44,7],[-17,16,-2,15,14,0,15,-13],[-26,3,10,9,6,1,0,-23],[-22,9,5,-11,-10,-2,3,-19],[-31,8,-7,-37,-36,-14,3,-31],[0,0,0,0,0,0,0,0]],n:[[-66,-53,-75,-75,-10,-55,-58,-70],[-3,-6,100,-36,4,62,-4,-14],[10,67,1,74,73,27,62,-2],[24,24,45,37,33,41,25,17],[-1,5,31,21,22,35,2,0],[-18,10,13,22,18,15,11,-14],[-23,-15,2,0,2,0,-23,-20],[-74,-23,-26,-24,-19,-35,-22,-69]],b:[[-59,-78,-82,-76,-23,-107,-37,-50],[-11,20,35,-42,-39,31,2,-22],[-9,39,-32,41,52,-10,28,-14],[25,17,20,34,26,25,15,10],[13,10,17,23,17,16,0,7],[14,25,24,15,8,25,20,15],[19,20,11,6,7,6,20,16],[-7,2,-15,-12,-14,-15,-10,-10]],r:[[35,29,33,4,37,33,56,50],[55,29,56,67,55,62,34,60],[19,35,28,33,45,27,25,15],[0,5,16,13,18,-4,-9,-6],[-28,-35,-16,-21,-13,-29,-46,-30],[-42,-28,-42,-25,-25,-35,-26,-46],[-53,-38,-31,-26,-29,-43,-44,-53],[-30,-24,-18,5,-2,-18,-31,-32]],q:[[6,1,-8,-104,69,24,88,26],[14,32,60,-10,20,76,57,24],[-2,43,32,60,72,63,43,2],[1,-16,22,17,25,20,-13,-6],[-14,-15,-2,-5,-1,-10,-20,-22],[-30,-6,-13,-11,-16,-11,-16,-27],[-36,-18,0,-19,-15,-15,-21,-38],[-39,-30,-31,-13,-31,-36,-34,-42]],k:[[4,54,47,-99,-99,60,83,-62],[-32,10,55,56,56,55,10,3],[-62,12,-57,44,-67,28,37,-31],[-55,50,11,-4,-19,13,0,-49],[-55,-43,-52,-28,-51,-47,-8,-50],[-47,-42,-43,-79,-64,-32,-29,-32],[-4,3,-14,-50,-57,-18,13,4],[17,30,-3,-14,6,-1,40,18]],k_endGame:[[-50,-40,-30,-20,-20,-30,-40,-50],[-30,-20,-10,0,0,-10,-20,-30],[-30,-10,20,30,30,20,-10,-30],[-30,-10,30,40,40,30,-10,-30],[-30,-10,30,40,40,30,-10,-30],[-30,-10,20,30,30,20,-10,-30],[-30,-30,0,0,0,0,-30,-30],[-50,-30,-30,-30,-30,-30,-30,-50]]};var i=r(465),n=r.n(i);const l={a:7,b:6,c:5,d:4,e:3,f:2,g:1,h:0};function c(e){if(e.length>2)return void console.error("Chess notation cannot be longer than 2");const t=e[0];return{row:parseInt(e[1],10)-1,column:l[t]}}const u=new class{constructor(){this.prevSum=0,this.chessGame=new o.qQ}blackStartInit(){this.aiSquareTables=this.reverseSquareTablesForBlack(),this.opponentSquareTables=n()(s)}whiteStartInit(){this.aiSquareTables=n()(s),this.opponentSquareTables=this.reverseSquareTablesForBlack()}reverseSquareTablesForBlack(){const e=n()(s);for(const t of Object.values(e))t.reverse();return e}minimax(e,t,r,o,a){let s,i,n=-1/0,l=1/0;const c=this.chessGame.moves();if(0===e||0===c.length)return[null,t];for(const u of c){i=this.chessGame.move(u);const c=this.evaluateBoard(i,t),[h,m]=this.minimax(e-1,c,!r,o,a);if(this.chessGame.undo(),r){if(m>n&&(n=m,s=i),a<=(o=Math.max(o,m)))break}else if(m<l&&(l=m,s=i),(a=Math.min(m,a))<=o)break}return r?[s,n]:[s,l]}evaluateBoard(e,t){let r=t;const{row:o,column:s}=c(e.from),{row:i,column:n}=c(e.to),{captured:l,color:u,flags:h}=e;let m=e.piece;if(this.isEndGameKing(t,m)&&(m="k_endGame"),l&&(this.isAiColor(u)?r+=a[l]+this.getOpponentValueFromSquareTable(l,{row:i,column:n}):r-=a[l]+this.getAiValueFromSquareTable(l,{row:i,column:n})),function(e){return e.includes("p")}(h)){const e="q";this.isAiColor(u)?(r-=a[m]+this.getAiValueFromSquareTable(m,{row:o,column:s}),r+=a[e]+this.getAiValueFromSquareTable(e,{row:o,column:s})):(r+=a[m]+this.getAiValueFromSquareTable(m,{row:o,column:s}),r-=a[e]+this.getAiValueFromSquareTable(m,{row:i,column:n}))}else this.isAiColor(u)?(r-=this.getAiValueFromSquareTable(m,{row:o,column:s}),r+=this.getAiValueFromSquareTable(m,{row:i,column:n})):(r+=this.getAiValueFromSquareTable(m,{row:o,column:s}),r-=this.getAiValueFromSquareTable(m,{row:i,column:n}));return r}isAiColor(e){return e===this.color}isEndGameKing(e,t){return e<-1500&&"k"===t}getOpponentValueFromSquareTable(e,t){const{row:r,column:o}=t;return this.opponentSquareTables[e][r][o]}getAiValueFromSquareTable(e,t){const{row:r,column:o}=t;return this.aiSquareTables[e][r][o]}isWhite(){return"w"===this.color}isBlack(){return"b"===this.color}init(e,t){this.color=e,this.chessGame.load(t),this.isBlack()?this.blackStartInit():this.whiteStartInit()}updateBoardWithPlayerMove(e){this.chessGame.move(e),this.prevSum=this.evaluateBoard(e,this.prevSum)}updateChessEngineWithPromotion(e){const{move:t,chessNotationPos:r,pieceType:o,color:a}=e;t&&this.chessGame.move(t),this.chessGame.remove(r),this.chessGame.put({type:o,color:a},r),this.chessGame.load(this.chessGame.fen())}calcAiMove(){const[e,t]=this.minimax(3,this.prevSum,!0,-1/0,1/0);return this.prevSum=t,this.chessGame.move(e),e}};addEventListener("message",(e=>{switch(e.data.type){case"init":if(u.init(e.data.color,e.data.fen),u.isBlack())return;postMessage({type:"aiMovePerformed",aiMove:u.calcAiMove()});break;case"aiMove":u.updateBoardWithPlayerMove(e.data.playerMove),postMessage({type:"aiMovePerformed",aiMove:u.calcAiMove()});break;case"promote":u.updateChessEngineWithPromotion(e.data);break;default:return}}))}},o={};function a(e){var t=o[e];if(void 0!==t)return t.exports;var s=o[e]={id:e,loaded:!1,exports:{}};return r[e](s,s.exports,a),s.loaded=!0,s.exports}a.m=r,a.x=()=>{var e=a.O(void 0,[195],(()=>a(504)));return a.O(e)},e=[],a.O=(t,r,o,s)=>{if(!r){var i=1/0;for(u=0;u<e.length;u++){for(var[r,o,s]=e[u],n=!0,l=0;l<r.length;l++)(!1&s||i>=s)&&Object.keys(a.O).every((e=>a.O[e](r[l])))?r.splice(l--,1):(n=!1,s<i&&(i=s));if(n){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[r,o,s]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,r)=>(a.f[r](e,t),t)),[])),a.u=e=>e+".index.js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={504:1};a.f.i=(t,r)=>{e[t]||importScripts(a.p+a.u(t))};var t=self.webpackChunkchess_3d=self.webpackChunkchess_3d||[],r=t.push.bind(t);t.push=t=>{var[o,s,i]=t;for(var n in s)a.o(s,n)&&(a.m[n]=s[n]);for(i&&i(a);o.length;)e[o.pop()]=1;r(t)}})(),t=a.x,a.x=()=>a.e(195).then(t),a.x()})();
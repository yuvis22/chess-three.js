(self.webpackChunkchess_3d=self.webpackChunkchess_3d||[]).push([[195],{465:(r,e,t)=>{r=t.nmd(r);var n="__lodash_hash_undefined__",o=9007199254740991,i="[object Arguments]",u="[object Boolean]",a="[object Date]",f="[object Function]",c="[object GeneratorFunction]",l="[object Map]",s="[object Number]",p="[object Object]",h="[object Promise]",v="[object RegExp]",g="[object Set]",_="[object String]",d="[object Symbol]",b="[object WeakMap]",y="[object ArrayBuffer]",m="[object DataView]",E="[object Float32Array]",w="[object Float64Array]",A="[object Int8Array]",S="[object Int16Array]",C="[object Int32Array]",j="[object Uint8Array]",O="[object Uint8ClampedArray]",I="[object Uint16Array]",P="[object Uint32Array]",T=/\w*$/,R=/^\[object .+?Constructor\]$/,L=/^(?:0|[1-9]\d*)$/,k={};k[i]=k["[object Array]"]=k[y]=k[m]=k[u]=k[a]=k[E]=k[w]=k[A]=k[S]=k[C]=k[l]=k[s]=k[p]=k[v]=k[g]=k[_]=k[d]=k[j]=k[O]=k[I]=k[P]=!0,k["[object Error]"]=k[f]=k[b]=!1;var q="object"==typeof t.g&&t.g&&t.g.Object===Object&&t.g,N="object"==typeof self&&self&&self.Object===Object&&self,x=q||N||Function("return this")(),D=e&&!e.nodeType&&e,U=D&&r&&!r.nodeType&&r,Q=U&&U.exports===D;function $(r,e){return r.set(e[0],e[1]),r}function K(r,e){return r.add(e),r}function B(r,e,t,n){var o=-1,i=r?r.length:0;for(n&&i&&(t=r[++o]);++o<i;)t=e(t,r[o],o,r);return t}function M(r){var e=!1;if(null!=r&&"function"!=typeof r.toString)try{e=!!(r+"")}catch(r){}return e}function F(r){var e=-1,t=Array(r.size);return r.forEach((function(r,n){t[++e]=[n,r]})),t}function W(r,e){return function(t){return r(e(t))}}function G(r){var e=-1,t=Array(r.size);return r.forEach((function(r){t[++e]=r})),t}var z,V=Array.prototype,Z=Function.prototype,H=Object.prototype,J=x["__core-js_shared__"],X=(z=/[^.]+$/.exec(J&&J.keys&&J.keys.IE_PROTO||""))?"Symbol(src)_1."+z:"",Y=Z.toString,rr=H.hasOwnProperty,er=H.toString,tr=RegExp("^"+Y.call(rr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nr=Q?x.Buffer:void 0,or=x.Symbol,ir=x.Uint8Array,ur=W(Object.getPrototypeOf,Object),ar=Object.create,fr=H.propertyIsEnumerable,cr=V.splice,lr=Object.getOwnPropertySymbols,sr=nr?nr.isBuffer:void 0,pr=W(Object.keys,Object),hr=xr(x,"DataView"),vr=xr(x,"Map"),gr=xr(x,"Promise"),_r=xr(x,"Set"),dr=xr(x,"WeakMap"),br=xr(Object,"create"),yr=Kr(hr),mr=Kr(vr),Er=Kr(gr),wr=Kr(_r),Ar=Kr(dr),Sr=or?or.prototype:void 0,Cr=Sr?Sr.valueOf:void 0;function jr(r){var e=-1,t=r?r.length:0;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}function Or(r){var e=-1,t=r?r.length:0;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}function Ir(r){var e=-1,t=r?r.length:0;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}function Pr(r){this.__data__=new Or(r)}function Tr(r,e,t){var n=r[e];rr.call(r,e)&&Br(n,t)&&(void 0!==t||e in r)||(r[e]=t)}function Rr(r,e){for(var t=r.length;t--;)if(Br(r[t][0],e))return t;return-1}function Lr(r,e,t,n,o,h,b){var R;if(n&&(R=h?n(r,o,h,b):n(r)),void 0!==R)return R;if(!zr(r))return r;var L=Mr(r);if(L){if(R=function(r){var e=r.length,t=r.constructor(e);return e&&"string"==typeof r[0]&&rr.call(r,"index")&&(t.index=r.index,t.input=r.input),t}(r),!e)return function(r,e){var t=-1,n=r.length;for(e||(e=Array(n));++t<n;)e[t]=r[t];return e}(r,R)}else{var q=Ur(r),N=q==f||q==c;if(Wr(r))return function(r,e){if(e)return r.slice();var t=new r.constructor(r.length);return r.copy(t),t}(r,e);if(q==p||q==i||N&&!h){if(M(r))return h?r:{};if(R=function(r){return"function"!=typeof r.constructor||$r(r)?{}:zr(e=ur(r))?ar(e):{};var e}(N?{}:r),!e)return function(r,e){return qr(r,Dr(r),e)}(r,function(r,e){return r&&qr(e,Vr(e),r)}(R,r))}else{if(!k[q])return h?r:{};R=function(r,e,t,n){var o,i=r.constructor;switch(e){case y:return kr(r);case u:case a:return new i(+r);case m:return function(r,e){var t=e?kr(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.byteLength)}(r,n);case E:case w:case A:case S:case C:case j:case O:case I:case P:return function(r,e){var t=e?kr(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}(r,n);case l:return function(r,e,t){return B(e?t(F(r),!0):F(r),$,new r.constructor)}(r,n,t);case s:case _:return new i(r);case v:return function(r){var e=new r.constructor(r.source,T.exec(r));return e.lastIndex=r.lastIndex,e}(r);case g:return function(r,e,t){return B(e?t(G(r),!0):G(r),K,new r.constructor)}(r,n,t);case d:return o=r,Cr?Object(Cr.call(o)):{}}}(r,q,Lr,e)}}b||(b=new Pr);var x=b.get(r);if(x)return x;if(b.set(r,R),!L)var D=t?function(r){return function(r,e,t){var n=e(r);return Mr(r)?n:function(r,e){for(var t=-1,n=e.length,o=r.length;++t<n;)r[o+t]=e[t];return r}(n,t(r))}(r,Vr,Dr)}(r):Vr(r);return function(r,e){for(var t=-1,n=r?r.length:0;++t<n&&!1!==e(r[t],t););}(D||r,(function(o,i){D&&(o=r[i=o]),Tr(R,i,Lr(o,e,t,n,i,r,b))})),R}function kr(r){var e=new r.constructor(r.byteLength);return new ir(e).set(new ir(r)),e}function qr(r,e,t,n){t||(t={});for(var o=-1,i=e.length;++o<i;){var u=e[o],a=n?n(t[u],r[u],u,t,r):void 0;Tr(t,u,void 0===a?r[u]:a)}return t}function Nr(r,e){var t,n,o=r.__data__;return("string"==(n=typeof(t=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?o["string"==typeof e?"string":"hash"]:o.map}function xr(r,e){var t=function(r,e){return null==r?void 0:r[e]}(r,e);return function(r){return!(!zr(r)||(e=r,X&&X in e))&&(Gr(r)||M(r)?tr:R).test(Kr(r));var e}(t)?t:void 0}jr.prototype.clear=function(){this.__data__=br?br(null):{}},jr.prototype.delete=function(r){return this.has(r)&&delete this.__data__[r]},jr.prototype.get=function(r){var e=this.__data__;if(br){var t=e[r];return t===n?void 0:t}return rr.call(e,r)?e[r]:void 0},jr.prototype.has=function(r){var e=this.__data__;return br?void 0!==e[r]:rr.call(e,r)},jr.prototype.set=function(r,e){return this.__data__[r]=br&&void 0===e?n:e,this},Or.prototype.clear=function(){this.__data__=[]},Or.prototype.delete=function(r){var e=this.__data__,t=Rr(e,r);return!(t<0||(t==e.length-1?e.pop():cr.call(e,t,1),0))},Or.prototype.get=function(r){var e=this.__data__,t=Rr(e,r);return t<0?void 0:e[t][1]},Or.prototype.has=function(r){return Rr(this.__data__,r)>-1},Or.prototype.set=function(r,e){var t=this.__data__,n=Rr(t,r);return n<0?t.push([r,e]):t[n][1]=e,this},Ir.prototype.clear=function(){this.__data__={hash:new jr,map:new(vr||Or),string:new jr}},Ir.prototype.delete=function(r){return Nr(this,r).delete(r)},Ir.prototype.get=function(r){return Nr(this,r).get(r)},Ir.prototype.has=function(r){return Nr(this,r).has(r)},Ir.prototype.set=function(r,e){return Nr(this,r).set(r,e),this},Pr.prototype.clear=function(){this.__data__=new Or},Pr.prototype.delete=function(r){return this.__data__.delete(r)},Pr.prototype.get=function(r){return this.__data__.get(r)},Pr.prototype.has=function(r){return this.__data__.has(r)},Pr.prototype.set=function(r,e){var t=this.__data__;if(t instanceof Or){var n=t.__data__;if(!vr||n.length<199)return n.push([r,e]),this;t=this.__data__=new Ir(n)}return t.set(r,e),this};var Dr=lr?W(lr,Object):function(){return[]},Ur=function(r){return er.call(r)};function Qr(r,e){return!!(e=null==e?o:e)&&("number"==typeof r||L.test(r))&&r>-1&&r%1==0&&r<e}function $r(r){var e=r&&r.constructor;return r===("function"==typeof e&&e.prototype||H)}function Kr(r){if(null!=r){try{return Y.call(r)}catch(r){}try{return r+""}catch(r){}}return""}function Br(r,e){return r===e||r!=r&&e!=e}(hr&&Ur(new hr(new ArrayBuffer(1)))!=m||vr&&Ur(new vr)!=l||gr&&Ur(gr.resolve())!=h||_r&&Ur(new _r)!=g||dr&&Ur(new dr)!=b)&&(Ur=function(r){var e=er.call(r),t=e==p?r.constructor:void 0,n=t?Kr(t):void 0;if(n)switch(n){case yr:return m;case mr:return l;case Er:return h;case wr:return g;case Ar:return b}return e});var Mr=Array.isArray;function Fr(r){return null!=r&&function(r){return"number"==typeof r&&r>-1&&r%1==0&&r<=o}(r.length)&&!Gr(r)}var Wr=sr||function(){return!1};function Gr(r){var e=zr(r)?er.call(r):"";return e==f||e==c}function zr(r){var e=typeof r;return!!r&&("object"==e||"function"==e)}function Vr(r){return Fr(r)?function(r,e){var t=Mr(r)||function(r){return function(r){return function(r){return!!r&&"object"==typeof r}(r)&&Fr(r)}(r)&&rr.call(r,"callee")&&(!fr.call(r,"callee")||er.call(r)==i)}(r)?function(r,e){for(var t=-1,n=Array(r);++t<r;)n[t]=e(t);return n}(r.length,String):[],n=t.length,o=!!n;for(var u in r)!e&&!rr.call(r,u)||o&&("length"==u||Qr(u,n))||t.push(u);return t}(r):function(r){if(!$r(r))return pr(r);var e=[];for(var t in Object(r))rr.call(r,t)&&"constructor"!=t&&e.push(t);return e}(r)}r.exports=function(r){return Lr(r,!0,!0)}},941:(r,e,t)=>{"use strict";t.d(e,{qQ:()=>O});const n="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",o=["1-0","0-1","1/2-1/2","*"],i={b:[16,32,17,15],w:[-16,-32,-17,-15]},u={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},a=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],f=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],c={p:0,n:1,b:2,r:3,q:4,k:5},l={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},s={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},p={w:[{square:s.a1,flag:l.QSIDE_CASTLE},{square:s.h1,flag:l.KSIDE_CASTLE}],b:[{square:s.a8,flag:l.QSIDE_CASTLE},{square:s.h8,flag:l.KSIDE_CASTLE}]};function h(r){var e=r.charAt(0);if(e>="a"&&e<="h"){if(r.match(/[a-h]\d.*[a-h]\d/))return;return S}return"o"===(e=e.toLowerCase())?C:e}function v(r){return r.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function g(r){return r>>4}function _(r){return 15&r}function d(r){var e=_(r),t=g(r);return"abcdefgh".substring(e,e+1)+"87654321".substring(t,t+1)}function b(r){return r===w?E:w}function y(r){var e=r instanceof Array?[]:{};for(var t in r)e[t]="object"==typeof t?y(r[t]):r[t];return e}function m(r){return r.replace(/^\s+|\s+$/g,"")}const E="b",w="w",A=-1,S="p",C="k",j=(function(){for(var r=[],e=s.a8;e<=s.h1;e++)136&e?e+=7:r.push(d(e))}(),{NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"}),O=function(r){var e=new Array(128),t={w:A,b:A},O=w,I={w:0,b:0},P=A,T=0,R=1,L=[],k={},q={};function N(r){void 0===r&&(r=!1),e=new Array(128),t={w:A,b:A},O=w,I={w:0,b:0},P=A,T=0,R=1,L=[],r||(k={}),q={},B($())}function x(){for(var r=[],e={},t=function(r){r in q&&(e[r]=q[r])};L.length>0;)r.push(tr());for(t($());r.length>0;)er(r.pop()),t($());q=e}function D(){U(n)}function U(r,e){void 0===e&&(e=!1);var t=r.split(/\s+/),n=t[0],o=0;if(!Q(r).valid)return!1;N(e);for(var i=0;i<n.length;i++){var u=n.charAt(i);if("/"===u)o+=8;else if(-1!=="0123456789".indexOf(u))o+=parseInt(u,10);else{var a=u<"a"?w:E;F({type:u.toLowerCase(),color:a},d(o)),o++}}return O=t[1],t[2].indexOf("K")>-1&&(I.w|=l.KSIDE_CASTLE),t[2].indexOf("Q")>-1&&(I.w|=l.QSIDE_CASTLE),t[2].indexOf("k")>-1&&(I.b|=l.KSIDE_CASTLE),t[2].indexOf("q")>-1&&(I.b|=l.QSIDE_CASTLE),P="-"===t[3]?A:s[t[3]],T=parseInt(t[4],10),R=parseInt(t[5],10),B($()),!0}function Q(r){var e=r.split(/\s+/);if(6!==e.length)return{valid:!1,error_number:1,error:"FEN string must contain six space-delimited fields."};if(isNaN(parseInt(e[5]))||parseInt(e[5],10)<=0)return{valid:!1,error_number:2,error:"6th field (move number) must be a positive integer."};if(isNaN(parseInt(e[4]))||parseInt(e[4],10)<0)return{valid:!1,error_number:3,error:"5th field (half move counter) must be a non-negative integer."};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{valid:!1,error_number:4,error:"4th field (en-passant square) is invalid."};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(e[2]))return{valid:!1,error_number:5,error:"3rd field (castling availability) is invalid."};if(!/^(w|b)$/.test(e[1]))return{valid:!1,error_number:6,error:"2nd field (side to move) is invalid."};var t=e[0].split("/");if(8!==t.length)return{valid:!1,error_number:7,error:"1st field (piece positions) does not contain 8 '/'-delimited rows."};for(var n=0;n<t.length;n++){for(var o=0,i=!1,u=0;u<t[n].length;u++)if(isNaN(t[n][u])){if(!/^[prnbqkPRNBQK]$/.test(t[n][u]))return{valid:!1,error_number:9,error:"1st field (piece positions) is invalid [invalid piece]."};o+=1,i=!1}else{if(i)return{valid:!1,error_number:8,error:"1st field (piece positions) is invalid [consecutive numbers]."};o+=parseInt(t[n][u],10),i=!0}if(8!==o)return{valid:!1,error_number:10,error:"1st field (piece positions) is invalid [row too large]."}}return"3"==e[3][1]&&"w"==e[1]||"6"==e[3][1]&&"b"==e[1]?{valid:!1,error_number:11,error:"Illegal en-passant square"}:{valid:!0,error_number:0,error:"No errors."}}function $(){for(var r=0,t="",n=s.a8;n<=s.h1;n++){if(null==e[n])r++;else{r>0&&(t+=r,r=0);var o=e[n].color,i=e[n].type;t+=o===w?i.toUpperCase():i.toLowerCase()}n+1&136&&(r>0&&(t+=r),n!==s.h1&&(t+="/"),r=0,n+=8)}var u="";I[w]&l.KSIDE_CASTLE&&(u+="K"),I[w]&l.QSIDE_CASTLE&&(u+="Q"),I[E]&l.KSIDE_CASTLE&&(u+="k"),I[E]&l.QSIDE_CASTLE&&(u+="q"),u=u||"-";var a=P===A?"-":d(P);return[t,O,u,a,T,R].join(" ")}function K(r){for(var e=0;e<r.length;e+=2)"string"==typeof r[e]&&"string"==typeof r[e+1]&&(k[r[e]]=r[e+1]);return k}function B(r){L.length>0||(r!==n?(k.SetUp="1",k.FEN=r):(delete k.SetUp,delete k.FEN))}function M(r){var t=e[s[r]];return t?{type:t.type,color:t.color}:null}function F(r,n){if(!("type"in r)||!("color"in r))return!1;if(-1==="pnbrqkPNBRQK".indexOf(r.type.toLowerCase()))return!1;if(!(n in s))return!1;var o=s[n];return(r.type!=C||t[r.color]==A||t[r.color]==o)&&(e[o]={type:r.type,color:r.color},r.type===C&&(t[r.color]=o),B($()),!0)}function W(r,e,t,n,o){var i={color:O,from:e,to:t,flags:n,piece:r[e].type};return o&&(i.flags|=l.PROMOTION,i.promotion=o),r[t]?i.captured=r[t].type:n&l.EP_CAPTURE&&(i.captured=S),i}function G(r){function n(r,e,t,n,o){if(r[t].type!==S||0!==g(n)&&7!==g(n))e.push(W(r,t,n,o));else for(var i=["q","r","b","n"],u=0,a=i.length;u<a;u++)e.push(W(r,t,n,o,i[u]))}var o=[],a=O,f=b(a),c={b:1,w:6},p=s.a8,h=s.h1,v=!1,_=void 0===r||!("legal"in r)||r.legal,d=void 0===r||!("piece"in r)||"string"!=typeof r.piece||r.piece.toLowerCase();if(void 0!==r&&"square"in r){if(!(r.square in s))return[];p=h=s[r.square],v=!0}for(var y=p;y<=h;y++)if(136&y)y+=7;else{var m=e[y];if(null!=m&&m.color===a)if(m.type!==S||!0!==d&&d!==S){if(!0===d||d===m.type)for(var E=0,w=u[m.type].length;E<w;E++){var A=u[m.type][E];for(j=y;!(136&(j+=A));){if(null!=e[j]){if(e[j].color===a)break;n(e,o,y,j,l.CAPTURE);break}if(n(e,o,y,j,l.NORMAL),"n"===m.type||"k"===m.type)break}}}else{var j=y+i[a][0];if(null==e[j]){n(e,o,y,j,l.NORMAL);j=y+i[a][1];c[a]===g(y)&&null==e[j]&&n(e,o,y,j,l.BIG_PAWN)}for(E=2;E<4;E++)136&(j=y+i[a][E])||(null!=e[j]&&e[j].color===f?n(e,o,y,j,l.CAPTURE):j===P&&n(e,o,y,P,l.EP_CAPTURE))}}if(!(!0!==d&&d!==C||v&&h!==t[a])){if(I[a]&l.KSIDE_CASTLE){var T=(R=t[a])+2;null!=e[R+1]||null!=e[T]||V(f,t[a])||V(f,R+1)||V(f,T)||n(e,o,t[a],T,l.KSIDE_CASTLE)}var R;if(I[a]&l.QSIDE_CASTLE)T=(R=t[a])-2,null!=e[R-1]||null!=e[R-2]||null!=e[R-3]||V(f,t[a])||V(f,R-1)||V(f,T)||n(e,o,t[a],T,l.QSIDE_CASTLE)}if(!_)return o;var L=[];for(y=0,w=o.length;y<w;y++)er(o[y]),Z(a)||L.push(o[y]),tr();return L}function z(r,e){var t="";if(r.flags&l.KSIDE_CASTLE)t="O-O";else if(r.flags&l.QSIDE_CASTLE)t="O-O-O";else{if(r.piece!==S){var n=function(r,e){for(var t=r.from,n=r.to,o=r.piece,i=0,u=0,a=0,f=0,c=e.length;f<c;f++){var l=e[f].from,s=e[f].to;o===e[f].piece&&t!==l&&n===s&&(i++,g(t)===g(l)&&u++,_(t)===_(l)&&a++)}return i>0?u>0&&a>0?d(t):a>0?d(t).charAt(1):d(t).charAt(0):""}(r,e);t+=r.piece.toUpperCase()+n}r.flags&(l.CAPTURE|l.EP_CAPTURE)&&(r.piece===S&&(t+=d(r.from)[0]),t+="x"),t+=d(r.to),r.flags&l.PROMOTION&&(t+="="+r.promotion.toUpperCase())}return er(r),H()&&(J()?t+="#":t+="+"),tr(),t}function V(r,t){for(var n=s.a8;n<=s.h1;n++)if(136&n)n+=7;else if(null!=e[n]&&e[n].color===r){var o=e[n],i=n-t,u=i+119;if(a[u]&1<<c[o.type]){if(o.type===S){if(i>0){if(o.color===w)return!0}else if(o.color===E)return!0;continue}if("n"===o.type||"k"===o.type)return!0;for(var l=f[u],p=n+l,h=!1;p!==t;){if(null!=e[p]){h=!0;break}p+=l}if(!h)return!0}}return!1}function Z(r){return V(b(r),t[r])}function H(){return Z(O)}function J(){return H()&&0===G().length}function X(){return!H()&&0===G().length}function Y(){for(var r={},t=[],n=0,o=0,i=s.a8;i<=s.h1;i++)if(o=(o+1)%2,136&i)i+=7;else{var u=e[i];u&&(r[u.type]=u.type in r?r[u.type]+1:1,"b"===u.type&&t.push(o),n++)}if(2===n)return!0;if(3===n&&(1===r.b||1===r.n))return!0;if(n===r.b+2){var a=0,f=t.length;for(i=0;i<f;i++)a+=t[i];if(0===a||a===f)return!0}return!1}function rr(){for(var r=[],e={},t=!1;;){var n=tr();if(!n)break;r.push(n)}for(;;){var o=$().split(" ").slice(0,4).join(" ");if(e[o]=o in e?e[o]+1:1,e[o]>=3&&(t=!0),!r.length)break;er(r.pop())}return t}function er(r){var n=O,o=b(n);if(function(r){L.push({move:r,kings:{b:t.b,w:t.w},turn:O,castling:{b:I.b,w:I.w},ep_square:P,half_moves:T,move_number:R})}(r),e[r.to]=e[r.from],e[r.from]=null,r.flags&l.EP_CAPTURE&&(O===E?e[r.to-16]=null:e[r.to+16]=null),r.flags&l.PROMOTION&&(e[r.to]={type:r.promotion,color:n}),e[r.to].type===C){if(t[e[r.to].color]=r.to,r.flags&l.KSIDE_CASTLE){var i=r.to-1,u=r.to+1;e[i]=e[u],e[u]=null}else r.flags&l.QSIDE_CASTLE&&(i=r.to+1,u=r.to-2,e[i]=e[u],e[u]=null);I[n]=""}if(I[n])for(var a=0,f=p[n].length;a<f;a++)if(r.from===p[n][a].square&&I[n]&p[n][a].flag){I[n]^=p[n][a].flag;break}if(I[o])for(a=0,f=p[o].length;a<f;a++)if(r.to===p[o][a].square&&I[o]&p[o][a].flag){I[o]^=p[o][a].flag;break}P=r.flags&l.BIG_PAWN?"b"===O?r.to-16:r.to+16:A,r.piece===S||r.flags&(l.CAPTURE|l.EP_CAPTURE)?T=0:T++,O===E&&R++,O=b(O)}function tr(){var r=L.pop();if(null==r)return null;var n=r.move;t=r.kings,O=r.turn,I=r.castling,P=r.ep_square,T=r.half_moves,R=r.move_number;var o,i,u=O,a=b(O);if(e[n.from]=e[n.to],e[n.from].type=n.piece,e[n.to]=null,n.flags&l.CAPTURE)e[n.to]={type:n.captured,color:a};else if(n.flags&l.EP_CAPTURE){var f;f=u===E?n.to-16:n.to+16,e[f]={type:S,color:a}}return n.flags&(l.KSIDE_CASTLE|l.QSIDE_CASTLE)&&(n.flags&l.KSIDE_CASTLE?(o=n.to+1,i=n.to-1):n.flags&l.QSIDE_CASTLE&&(o=n.to-2,i=n.to+1),e[o]=e[i],e[i]=null),n}function nr(r,e){for(var t=v(r),n=0;n<2;n++){if(1==n){if(!e)return null;var o=!1;if(c=t.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/)){var i=c[1],u=c[2],a=c[3],f=c[4];1==u.length&&(o=!0)}else{var c;(c=t.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/))&&(i=c[1],u=c[2],a=c[3],f=c[4],1==u.length&&(o=!0))}}for(var l=h(t),p=G({legal:!0,piece:i||l}),g=0,_=p.length;g<_;g++)switch(n){case 0:if(t===v(z(p[g],p)))return p[g];break;case 1:if(c){if(!(i&&i.toLowerCase()!=p[g].piece||s[u]!=p[g].from||s[a]!=p[g].to||f&&f.toLowerCase()!=p[g].promotion))return p[g];if(o){var b=d(p[g].from);if(!(i&&i.toLowerCase()!=p[g].piece||s[a]!=p[g].to||u!=b[0]&&u!=b[1]||f&&f.toLowerCase()!=p[g].promotion))return p[g]}}}}return null}function or(r){var e=y(r);e.san=z(e,G({legal:!0})),e.to=d(e.to),e.from=d(e.from);var t="";for(var n in l)l[n]&e.flags&&(t+=j[n]);return e.flags=t,e}function ir(r){for(var e=G({legal:!1}),t=0,n=O,o=0,i=e.length;o<i;o++)er(e[o]),Z(n)||(r-1>0?t+=ir(r-1):t++),tr();return t}return U(void 0===r?n:r),{load:function(r){return U(r)},reset:function(){return D()},moves:function(r){for(var e=G(r),t=[],n=0,o=e.length;n<o;n++)void 0!==r&&"verbose"in r&&r.verbose?t.push(or(e[n])):t.push(z(e[n],G({legal:!0})));return t},in_check:function(){return H()},in_checkmate:function(){return J()},in_stalemate:function(){return X()},in_draw:function(){return T>=100||X()||Y()||rr()},insufficient_material:function(){return Y()},in_threefold_repetition:function(){return rr()},game_over:function(){return T>=100||J()||X()||Y()||rr()},validate_fen:function(r){return Q(r)},fen:function(){return $()},board:function(){for(var r=[],t=[],n=s.a8;n<=s.h1;n++)null==e[n]?t.push(null):t.push({square:d(n),type:e[n].type,color:e[n].color}),n+1&136&&(r.push(t),t=[],n+=8);return r},pgn:function(r){var e="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\n",t="object"==typeof r&&"number"==typeof r.max_width?r.max_width:0,n=[],o=!1;for(var i in k)n.push("["+i+' "'+k[i]+'"]'+e),o=!0;o&&L.length&&n.push(e);for(var u=function(r){var e=q[$()];return void 0!==e&&(r=`${r}${r.length>0?" ":""}{${e}}`),r},a=[];L.length>0;)a.push(tr());var f=[],c="";for(0===a.length&&f.push(u(""));a.length>0;){c=u(c);var l=a.pop();if(L.length||"b"!==l.color)"w"===l.color&&(c.length&&f.push(c),c=R+".");else{const r=`${R}. ...`;c=c?`${c} ${r}`:r}c=c+" "+z(l,G({legal:!0})),er(l)}if(c.length&&f.push(u(c)),void 0!==k.Result&&f.push(k.Result),0===t)return n.join("")+f.join(" ");var s=function(){return n.length>0&&" "===n[n.length-1]&&(n.pop(),!0)},p=function(r,o){for(var i of o.split(" "))if(i){if(r+i.length>t){for(;s();)r--;n.push(e),r=0}n.push(i),r+=i.length,n.push(" "),r++}return s()&&r--,r},h=0;for(i=0;i<f.length;i++)h+f[i].length>t&&f[i].includes("{")?h=p(h,f[i]):(h+f[i].length>t&&0!==i?(" "===n[n.length-1]&&n.pop(),n.push(e),h=0):0!==i&&(n.push(" "),h++),n.push(f[i]),h+=f[i].length);return n.join("")},load_pgn:function(r,e){var t=void 0!==e&&"sloppy"in e&&e.sloppy;function n(r){return r.replace(/\\/g,"\\")}r=r.trim();var i="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",u=new RegExp("^(\\[((?:"+n(i)+")|.)*\\])(?:\\s*"+n(i)+"){2}"),a=u.test(r)?u.exec(r)[1]:"";D();var f=function(r,e){for(var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",o={},i=r.split(new RegExp(n(t))),u="",a="",f=0;f<i.length;f++){var c=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;u=i[f].replace(c,"$1"),a=i[f].replace(c,"$2"),m(u).length>0&&(o[u]=a)}return o}(a,e),c="";for(var l in f)"fen"===l.toLowerCase()&&(c=f[l]),K([l,f[l]]);if(t){if(c&&!U(c,!0))return!1}else if(!("1"!==f.SetUp||"FEN"in f&&U(f.FEN,!0)))return!1;for(var s=function(r){return`{${function(r){return Array.from(r).map((function(r){return r.charCodeAt(0)<128?r.charCodeAt(0).toString(16):encodeURIComponent(r).replace(/\%/g,"").toLowerCase()})).join("")}((r=r.replace(new RegExp(n(i),"g")," ")).slice(1,r.length-1))}}`},p=function(r){if(r.startsWith("{")&&r.endsWith("}"))return function(r){return 0==r.length?"":decodeURIComponent("%"+r.match(/.{1,2}/g).join("%"))}(r.slice(1,r.length-1))},h=r.replace(a,"").replace(new RegExp(`({[^}]*})+?|;([^${n(i)}]*)`,"g"),(function(r,e,t){return void 0!==e?s(e):" "+s(`{${t.slice(1)}}`)})).replace(new RegExp(n(i),"g")," "),v=/(\([^\(\)]+\))+?/g;v.test(h);)h=h.replace(v,"");var g=m(h=(h=(h=h.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));g=g.join(",").replace(/,,+/g,",").split(",");for(var _="",d="",b=0;b<g.length;b++){var y=p(g[b]);if(void 0===y)if(null==(_=nr(g[b],t))){if(!(o.indexOf(g[b])>-1))return!1;d=g[b]}else d="",er(_);else q[$()]=y}return d&&Object.keys(k).length&&!k.Result&&K(["Result",d]),!0},header:function(){return K(arguments)},turn:function(){return O},move:function(r,e){var t=void 0!==e&&"sloppy"in e&&e.sloppy,n=null;if("string"==typeof r)n=nr(r,t);else if("object"==typeof r)for(var o=G(),i=0,u=o.length;i<u;i++)if(r.from===d(o[i].from)&&r.to===d(o[i].to)&&(!("promotion"in o[i])||r.promotion===o[i].promotion)){n=o[i];break}if(!n)return null;var a=or(n);return er(n),a},undo:function(){var r=tr();return r?or(r):null},clear:function(){return N()},put:function(r,e){return F(r,e)},get:function(r){return M(r)},ascii(){for(var r="   +------------------------+\n",t=s.a8;t<=s.h1;t++){if(0===_(t)&&(r+=" "+"87654321"[g(t)]+" |"),null==e[t])r+=" . ";else{var n=e[t].type;r+=" "+(e[t].color===w?n.toUpperCase():n.toLowerCase())+" "}t+1&136&&(r+="|\n",t+=8)}return(r+="   +------------------------+\n")+"     a  b  c  d  e  f  g  h"},remove:function(r){return function(r){var n=M(r);return e[s[r]]=null,n&&n.type===C&&(t[n.color]=A),B($()),n}(r)},perft:function(r){return ir(r)},square_color:function(r){if(r in s){var e=s[r];return(g(e)+_(e))%2==0?"light":"dark"}return null},history:function(r){for(var e=[],t=[],n=(void 0!==r&&"verbose"in r&&r.verbose);L.length>0;)e.push(tr());for(;e.length>0;){var o=e.pop();n?t.push(or(o)):t.push(z(o,G({legal:!0}))),er(o)}return t},get_comment:function(){return q[$()]},set_comment:function(r){q[$()]=r.replace("{","[").replace("}","]")},delete_comment:function(){var r=q[$()];return delete q[$()],r},get_comments:function(){return x(),Object.keys(q).map((function(r){return{fen:r,comment:q[r]}}))},delete_comments:function(){return x(),Object.keys(q).map((function(r){var e=q[r];return delete q[r],{fen:r,comment:e}}))}}}}}]);